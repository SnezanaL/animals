<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Animal Shelter</title>
    <!-- TailwindCSS is pretty cool -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  </head>
  <body>
    <section class="text-gray-600 body-font">
      <div class="container px-5 py-24 mx-auto">
        <div class="flex flex-wrap -m-4" id="cards"></div>
      </div>
    </section>

    <template id="card">
      <div class="p-4 md:w-1/3">
        <div
          class="h-full border-2 border-gray-200 border-opacity-60 rounded-lg overflow-hidden">
          <img
            class="lg:h-48 md:h-36 w-full object-cover object-center"
            src="https://dummyimage.com/720x400"
            alt="blog" />
          <div class="p-6">
            <h1 class="title-font text-lg font-medium text-gray-900 mb-3 name">
              {{name}}
            </h1>
            <p class="leading-relaxed mb-3 desc">{{desc}}</p>
            <div class="flex items-center flex-wrap">
              <a class="text-pink-500 inline-flex items-center md:mb-2 lg:mb-0"
                >Learn More
                <svg
                  class="w-4 h-4 ml-2"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                  fill="none"
                  stroke-linecap="round"
                  stroke-linejoin="round">
                  <path d="M5 12h14"></path>
                  <path d="M12 5l7 7-7 7"></path>
                </svg>
              </a>
              <span
                onclick="like(this)"
                class="cursor-pointer hearts-img text-gray-400 mr-3 inline-flex items-center lg:ml-auto md:ml-0 ml-auto leading-none text-sm">
                ❤️
                <span class="pl-1 hearts">{{hearts}}</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </template>

    <script>
      window.onload = function (e) {
        fetchAnimals();
      };

      // This is a fake list of animals
      // const fakeAnimals = [
      //   {
      //     name: "Bean",
      //     desc: "Bean LOVEs food. More couch potato than star athlete. Speaks 4 languages, used to be top 20 in the world at Age of Empires II but now mostly plays chess. Diabetic.",
      //     hearts: 6,
      //   },
      //   {
      //     name: "Burt",
      //     desc: "Burt is and older cat that is looking for a quiet life indoors. Used to be a plumber, we think. FIV+.",
      //     hearts: 3,
      //   },
      //   {
      //     name: "Thundersocks",
      //     desc: "Thundersocks is very young, active and full of life. Lives for water activities and tug-of-war.",
      //     hearts: 4,
      //   },
      //   {
      //     name: "Gop",
      //     desc: "Gop is scared of most things and needs a calm home. Likes death metal and sci-fi.",
      //     hearts: 516,
      //   },
      // ];

      const cards = document.querySelector("#cards");
      const tmpl = document.querySelector("#card");

      function cardify(animal) {
        const element = tmpl.content.cloneNode(true);
        element.querySelector(".name").innerText = animal.name;
        element.querySelector(".desc").innerText = animal.desc;
        element.querySelector(".hearts").innerText = animal.hearts;
        element.querySelector(".hearts-img").id = animal._id;
        cards.append(element);
      }

      // Fetch the animals from the API
      let animalList = [];
      async function fetchAnimals() {
        try {
          const response = await fetch("http://localhost:3000/animals");
          const data = await response.json();
          animalList = data.data;
          animalList.forEach(cardify);
        } catch (error) {
          console.error("Error fetching animals:", error);
        }
      }

      // Like an animal
      async function like(element) {
        const animalId = element.id;

        const animal = animalList.find((a) => a._id == animalId);

        const response = await fetch(
          `http://localhost:3000/animals/like/${animalId}`,
          {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ hearts: element.hearts++ }),
          }
        );
        // If the request is successful, refresh the page
        document.location.reload();
      }
    </script>
  </body>
</html>
